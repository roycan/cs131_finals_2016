package final_implicit;

import org.junit.Test;

import static org.junit.Assert.*;

/**
 * Created by angeloarenas on 21/02/2017.
 */
public class EulerImplicitTest {

    @Test
    public void testGivenProblem() {
        double firstNum = 0, lastNum = 0.5, stepSize = 0.002, eulerN;
        int i, newtonN;
        eulerN = (lastNum - firstNum)/stepSize; // number of iterations for euler
        newtonN = 250; // number of iterations for newton

        double[] n = new double[251];
        double[] t = new double[251];

        n[0] = 0;
        n[1] = 2000; t[1] = firstNum;

        for(i = 1; i < eulerN; i++) {
            t[i + 1] = t[i] + stepSize;

            Double fun_component1 = -(10 * 2000 * ( 1-Math.exp(-3*(t[i+1]))) * stepSize) - n[i];
            Double fun_component2 = 0.8 * stepSize;

            String fun = "x + x^(3/2) * " + fun_component2 + " + " + fun_component1;
            String funDer = "1 + x^(1/2) * (3/2) * " + fun_component2;

            n[i+1] = NewtonRoot.doNewtonRoot(fun, funDer, n[i], 0.001, newtonN);
        }

        double[] expected = new double[251];

        expected[0] = 0;
        expected[1] =	2000.0;
        expected[2] =	1870.7743648266037;
        expected[3] =	1753.7430889976258;
        expected[4] =	1647.4662569469922;
        expected[5] =	1550.7100337476231;
        expected[6] =	1462.4124550881477;
        expected[7] =	1381.6556302454933;
        expected[8] =	1307.6430257468335;
        expected[9] =	1239.6807997854273;
        expected[10] =	1177.1623856943474;
        expected[11] =	1119.5556963481158;
        expected[12] =	1066.3924542847824;
        expected[13] =	1017.2592548214958;
        expected[14] =	971.7900489522507;
        expected[15] =	929.659794889362;
        expected[16] =	890.5790758481563;
        expected[17] =	854.2895201544547;
        expected[18] =	820.5598902966638;
        expected[19] =	789.1827319091594;
        expected[20] =	759.9714932049689;
        expected[21] =	732.7580411052911;
        expected[22] =	707.3905130377424;
        expected[23] =	683.7314537126306;
        expected[24] =	661.6561946194171;
        expected[25] =	641.0514408918771;
        expected[26] =	621.8140358682579;
        expected[27] =	603.8498783575234;
        expected[28] =	587.0729715019506;
        expected[29] =	571.4045853492725;
        expected[30] =	556.7725179341262;
        expected[31] =	543.110441915031;
        expected[32] =	530.3573256973441;
        expected[33] =	518.4569195576836;
        expected[34] =	507.35729862244904;
        expected[35] =	497.01045568418414;
        expected[36] =	487.3719377989251;
        expected[37] =	478.4005214234622;
        expected[38] =	470.0579215469184;
        expected[39] =	462.30853086531647;
        expected[40] =	455.11918555683246;
        expected[41] =	448.458954652427;
        expected[42] =	442.2989503725287;
        expected[43] =	436.61215712464775;
        expected[44] =	431.37327713694117;
        expected[45] =	426.55859094532985;
        expected[46] =	422.1458311622517;
        expected[47] =	418.1140681381368;
        expected[48] =	414.44360628612003;
        expected[49] =	411.11588997967283;
        expected[50] =	408.1134180545577;
        expected[51] =	405.4196660531748;
        expected[52] =	403.01901544302757;
        expected[53] =	400.89668912343393;
        expected[54] =	399.0386926072317;
        expected[55] =	397.431760328368;
        expected[56] =	396.06330658301226;
        expected[57] =	394.9213806621396;
        expected[58] =	393.9946257782128;
        expected[59] =	393.27224142834325;
        expected[60] =	392.74394887174765;
        expected[61] =	392.3999628513069;
        expected[62] =	392.23094944573256;
        expected[63] =	392.22801691030895;
        expected[64] =	392.38268257440274;
        expected[65] =	392.68685009684515;
        expected[66] =	393.13278271213903;
        expected[67] =	393.7130973241403;
        expected[68] =	394.42073613418756;
        expected[69] =	395.2489527301959;
        expected[70] =	396.1912965646967;
        expected[71] =	397.24159851688984;
        expected[72] =	398.3939574418144;
        expected[73] =	399.6427276188279;
        expected[74] =	400.9825070198277;
        expected[75] =	402.40812632512547;
        expected[76] =	403.91463862167774;
        expected[77] =	405.49730972453955;
        expected[78] =	407.1516090680065;
        expected[79] =	408.87320111799835;
        expected[80] =	410.6579372618532;
        expected[81] =	412.50184813589567;
        expected[82] =	414.4011363549482;
        expected[83] =	416.3521696114094;
        expected[84] =	418.3514741146538;
        expected[85] =	420.39572834435006;
        expected[86] =	422.48175709386396;
        expected[87] =	424.60652578224284;
        expected[88] =	426.76713501538353;
        expected[89] =	428.96081537888904;
        expected[90] =	431.18492244683756;
        expected[91] =	433.43693199223696;
        expected[92] =	435.7144353863333;
        expected[93] =	438.0151351751986;
        expected[94] =	440.33684082315074;
        expected[95] =	442.6774646135719;
        expected[96] =	445.0350176986;
        expected[97] =	447.40760628997754;
        expected[98] =	449.7934279840714;
        expected[99] =	452.1907682147216;
        expected[100] =	454.5979968281548;
        expected[101] =	457.0135647747127;
        expected[102] =	459.43600091259646;
        expected[103] =	461.86390891923566;
        expected[104] =	464.2959643062457;
        expected[105] =	466.7309115342523;
        expected[106] =	469.1675612241383;
        expected[107] =	471.6047874615163;
        expected[108] =	474.04152519144037;
        expected[109] =	476.47676770056256;
        expected[110] =	478.90956418410383;
        expected[111] =	481.3390173951512;
        expected[112] =	483.7642813739237;
        expected[113] =	486.18455925475666;
        expected[114] =	488.5991011486509;
        expected[115] =	491.00720209932035;
        expected[116] =	493.4082001107417;
        expected[117] =	495.8014742442785;
        expected[118] =	498.1864427835067;
        expected[119] =	500.56256146491916;
        expected[120] =	502.9293217727348;
        expected[121] =	505.286249296073;
        expected[122] =	507.6329021467987;
        expected[123] =	509.96886943636326;
        expected[124] =	512.2937698100152;
        expected[125] =	514.6072500367651;
        expected[126] =	516.9089836535276;
        expected[127] =	519.1986696618852;
        expected[128] =	521.4760312759503;
        expected[129] =	523.7408147198028;
        expected[130] =	525.9927880730421;
        expected[131] =	528.2317401629817;
        expected[132] =	530.4574795020546;
        expected[133] =	532.6698332690203;
        expected[134] =	534.8686463325851;
        expected[135] =	537.0537803160719;
        expected[136] =	539.2251127018008;
        expected[137] =	541.3825359738678;
        expected[138] =	543.52595679803;
        expected[139] =	545.655295237434;
        expected[140] =	547.7704840029536;
        expected[141] =	549.8714677369172;
        expected[142] =	551.9582023290454;
        expected[143] =	554.0306542634377;
        expected[144] =	556.0887999954771;
        expected[145] =	558.1326253575427;
        expected[146] =	560.1621249924599;
        expected[147] =	562.1773018136319;
        expected[148] =	564.178166490826;
        expected[149] =	566.1647369606314;
        expected[150] =	568.1370379606028;
        expected[151] =	570.0951005861598;
        expected[152] =	572.0389618693232;
        expected[153] =	573.9686643784;
        expected[154] =	575.8842558377607;
        expected[155] =	577.7857887668644;
        expected[156] =	579.673320137735;
        expected[157] =	581.5469110500987;
        expected[158] =	583.406626423426;
        expected[159] =	585.2525347051508;
        expected[160] =	587.0847075943517;
        expected[161] =	588.9032197802266;
        expected[162] =	590.7081486946829;
        expected[163] =	592.4995742784249;
        expected[164] =	594.2775787599152;
        expected[165] =	596.0422464466241;
        expected[166] =	597.7936635280028;
        expected[167] =	599.5319178896236;
        expected[168] =	601.2570989379701;
        expected[169] =	602.9692974353719;
        expected[170] =	604.6686053445912;
        expected[171] =	606.3551156826029;
        expected[172] =	608.0289223831186;
        expected[173] =	609.6901201674187;
        expected[174] =	611.3388044230948;
        expected[175] =	612.9750710902935;
        expected[176] =	614.5990165550933;
        expected[177] =	616.2107375496512;
        expected[178] =	617.810331058766;
        expected[179] =	619.3978942325411;
        expected[180] =	620.9735243048134;
        expected[181] =	622.5373185170598;
        expected[182] =	624.0893740474876;
        expected[183] =	625.629787945026;
        expected[184] =	627.1586570679657;
        expected[185] =	628.6760780269923;
        expected[186] =	630.1821471323659;
        expected[187] =	631.6769603450321;
        expected[188] =	633.1606132314348;
        expected[189] =	634.6332009218298;
        expected[190] =	636.0948180719;
        expected[191] =	637.5455588274824;
        expected[192] =	638.9855167922344;
        expected[193] =	640.4147849980615;
        expected[194] =	641.8334558781484;
        expected[195] =	643.2416212424416;
        expected[196] =	644.6393722554371;
        expected[197] =	646.0267994161289;
        expected[198] =	647.4039925400011;
        expected[199] =	648.7710407429157;
        expected[200] =	650.1280324268075;
        expected[201] =	651.4750552670463;
        expected[202] =	652.8121962013778;
        expected[203] =	654.1395414203366;
        expected[204] =	655.4571763590353;
        expected[205] =	656.7651856902431;
        expected[206] =	658.0636533186637;
        expected[207] =	659.3526623763378;
        expected[208] =	660.632295219089;
        expected[209] =	661.9026334239427;
        expected[210] =	663.1637577874513;
        expected[211] =	664.4157483248613;
        expected[212] =	665.6586842700606;
        expected[213] =	666.8926440762465;
        expected[214] =	668.117705417269;
        expected[215] =	669.3339451895881;
        expected[216] =	670.5414395148031;
        expected[217] =	671.7402637427116;
        expected[218] =	672.9304924548488;
        expected[219] =	674.1121994684711;
        expected[220] =	675.2854578409474;
        expected[221] =	676.4503398745242;
        expected[222] =	677.6069171214235;
        expected[223] =	678.755260389253;
        expected[224] =	679.8954397466931;
        expected[225] =	681.027524529435;
        expected[226] =	682.1515833463465;
        expected[227] =	683.267684085835;
        expected[228] =	684.3758939223961;
        expected[229] =	685.4762793233177;
        expected[230] =	686.5689060555219;
        expected[231] =	687.6538391925307;
        expected[232] =	688.7311431215343;
        expected[233] =	689.80088155055;
        expected[234] =	690.8631175156487;
        expected[235] =	691.9179133882493;
        expected[236] =	692.9653308824523;
        expected[237] =	694.0054310624164;
        expected[238] =	695.0382743497506;
        expected[239] =	696.0639205309307;
        expected[240] =	697.082428764711;
        expected[241] =	698.0938575895383;
        expected[242] =	699.0982649309517;
        expected[243] =	700.0957081089649;
        expected[244] =	701.0862438454199;
        expected[245] =	702.0699282713103;
        expected[246] =	703.0468169340681;
        expected[247] =	704.0169648048023;
        expected[248] =	704.9804262854984;
        expected[249] =	705.9372552161578;
        expected[250] =	706.8875048818832;

        assertArrayEquals("Must pass given problem", expected, n, 0.001);
    }
}